(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{393:function(s,a,t){"use strict";t.r(a);var n=t(42),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"模板使用指南"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#模板使用指南"}},[s._v("#")]),s._v(" 模板使用指南")]),s._v(" "),t("p",[t("code",[s._v("thexp")]),s._v(" 提供了一套高扩展性、易用性的模板。")]),s._v(" "),t("h2",{attrs:{id:"初始化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始化"}},[s._v("#")]),s._v(" 初始化")]),s._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[s._v("初始化需要 Git")]),s._v(" "),t("p",[s._v("模板初始化需要 "),t("code",[s._v("Git")]),s._v(" 环境")])]),s._v(" "),t("p",[s._v("使用方式和 "),t("code",[s._v("Git")]),s._v(" 类似：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("thexp init\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("随后你会看到目录下生成了一系列的文件：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("E:.\n├ .gitignore\n├ .thexp.1.4.1.17\n│\n└─anyproj\n    ├ arch\n    │  └ __init__.py\n    │\n    ├─data\n    │  ├ dataxy.py\n    │  ├ delegate.py\n    │  ├ transforms.py\n    │  └ __init__.py\n    │\n    └─trainers\n        ├ __init__.py\n        ├ __trainer.py\n        │\n        └─mixin\n            ├ acc.py\n            ├ callbacks.py\n            ├ datasets.py\n            ├ losses.py\n            ├ models.py\n            ├ tricks.py\n            └ __init__.py\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("h2",{attrs:{id:"目录结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#目录结构"}},[s._v("#")]),s._v(" 目录结构")]),s._v(" "),t("p",[s._v("可以看到基础的目录只有三个： 用于处理和提供数据有关的"),t("code",[s._v("data")]),s._v("，用于提供模型结构的"),t("code",[s._v("arch")]),s._v("，以及用于训练的"),t("code",[s._v("trainer")])]),s._v(" "),t("h2",{attrs:{id:"arch"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#arch"}},[s._v("#")]),s._v(" arch")]),s._v(" "),t("p",[s._v("arch(architecture) 目录下建议放置最基础的模型文件，一个文件一个模型即可，没有其他更多的需求或变动，这也是最常用的方式。")]),s._v(" "),t("h2",{attrs:{id:"data"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#data"}},[s._v("#")]),s._v(" data")]),s._v(" "),t("p",[s._v("data 目录下会有许多内容，这包括")]),s._v(" "),t("ul",[t("li",[s._v("数据源的提供（dataxy.py）")]),s._v(" "),t("li",[s._v("数据增广方法（transform.py)")]),s._v(" "),t("li",[t("code",[s._v("thexp")]),s._v(" 中的 "),t("code",[s._v("delegate")]),s._v(" 构建（delegate.py）")])]),s._v(" "),t("h3",{attrs:{id:"数据源-dataxy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据源-dataxy"}},[s._v("#")]),s._v(" 数据源(dataxy)")]),s._v(" "),t("p",[s._v("数据源中已经写好了一个 "),t("code",[s._v("cifar10")]),s._v(" 数据集的示例，这里建议的写法是按照元组的形式提供样本和标签，而不是以 "),t("code",[s._v("torch")]),s._v(" 中 "),t("code",[s._v("Dataset")]),s._v(" 的形式，这样配合 "),t("code",[s._v("thexp")]),s._v(" 提供的 "),t("a",{attrs:{href:"/thexp/builder"}},[s._v("DatasetBuilder")]),s._v("，就能够以更灵活的形式构建数据集。")]),s._v(" "),t("h3",{attrs:{id:"数据增广方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据增广方法"}},[s._v("#")]),s._v(" 数据增广方法")]),s._v(" "),t("p",[s._v("大部分增广方法都是通过多个增广方法组合而成，如计算机视觉领域常用的随机翻转裁切的增广：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" torchvision "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" transforms\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Weak")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("__init__")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" mean"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" std"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        lis "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            transforms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("RandomHorizontalFlip"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            transforms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("RandomCrop"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("size"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                  padding"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                  padding_mode"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'reflect'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            transforms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ToTensor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" mean "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("is")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("and")]),s._v(" std "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("is")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            lis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("append"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("transforms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Normalize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mean"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" std"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("std"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("weak "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" transforms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Compose"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("__call__")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("weak"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("这也是 "),t("code",[s._v("transform.py")]),s._v(" 中建议编写的内容。")]),s._v(" "),t("h3",{attrs:{id:"代理（delegate）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#代理（delegate）"}},[s._v("#")]),s._v(" 代理（delegate）")]),s._v(" "),t("p",[s._v("专用于提供 "),t("code",[s._v("Delegate")]),s._v(" , 该部请份参考 "),t("RouterLink",{attrs:{to:"/thexp/builder/#代理"}},[s._v("DatasetBuilder#Delegate")])],1),s._v(" "),t("h2",{attrs:{id:"trainer"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#trainer"}},[s._v("#")]),s._v(" trainer")]),s._v(" "),t("p",[s._v("trainer 文件用于存放各种 "),t("code",[s._v("Trainer")]),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"编写即运行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编写即运行"}},[s._v("#")]),s._v(" 编写即运行")]),s._v(" "),t("p",[s._v("参考 trainer 文件夹初始化后生成的 "),t("code",[s._v("_trainer.py")]),s._v(" 文件的代码，您可以发现在开头和结尾进行了程序入口（"),t("strong",[s._v("main")]),s._v("）判断，并进行了相应的切换目录等操作。这意味这这样的文件可以写好了直接运行，省去了在项目下另见一个文件来 run 的操作。")]),s._v(" "),t("h3",{attrs:{id:"多继承-mixin"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#多继承-mixin"}},[s._v("#")]),s._v(" 多继承/Mixin")]),s._v(" "),t("p",[s._v("通过 Python 的多继承机制，相似试验之间的相同功能可以本很好的拆分出来，以类的方式构造，并通过多继承的方式（Mixin机制）融入到各个 "),t("code",[s._v("Trainer")]),s._v(" 中")]),s._v(" "),t("p",[s._v("您可以看到 "),t("code",[s._v("trainers/mixin")]),s._v(" 目录下，已经分门别类的放好了各种用途的 "),t("code",[s._v("Mixin")]),s._v(" ，并在 "),t("code",[s._v("_trainer.py")]),s._v(" 中进行了多继承：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TempleteTrainer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("callbacks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("BaseCBMixin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                      datasets"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TempleteDatasetMixin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                      models"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TempleteModelMixin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                      acc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ClassifyAccMixin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                      losses"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CELoss"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                      tricks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TrickMixin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                      Trainer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("对与小的改动，可以通过添加超参数，随后使用控制逻辑来切换；对于大的改动，则可以直接另外创建一个相应的 "),t("code",[s._v("Mixin")]),s._v(" 类和 "),t("code",[s._v("Trainer")]),s._v(" 类，在其中进行改动。这两种方式组合使用，能够很好的将单个实验的代码复杂度控制在一个很低的程度（定位代码段时保证在三次以内定位到相关代码上，且尽可能保证始终能够定位）")])])}),[],!1,null,null,null);a.default=e.exports}}]);