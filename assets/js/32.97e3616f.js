(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{397:function(s,a,t){"use strict";t.r(a);var n=t(42),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"训练流程抽象：trainer"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#训练流程抽象：trainer"}},[s._v("#")]),s._v(" 训练流程抽象：Trainer")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" thexp "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Trainer\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("前面的诸多模块均能够在不同程度上减少深度学习相应功能的冗余代码量，而该模块，则通过对训练逻辑的完整抽象以及其余模块的融合，大幅减少了试验核心逻辑之外的冗余代码。")]),s._v(" "),t("h2",{attrs:{id:"内部维护变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#内部维护变量"}},[s._v("#")]),s._v(" 内部维护变量")]),s._v(" "),t("p",[s._v("在下面的示例中可以看到 "),t("code",[s._v("Trainer")]),s._v(" 维护的这些变量，其中，"),t("code",[s._v("saver")]),s._v("/"),t("code",[s._v("rnd")]),s._v("/"),t("code",[s._v("logger")]),s._v("/"),t("code",[s._v("writter")]),s._v(" 均使用懒加载，仅在使用时会请求 "),t("code",[s._v("experiment")]),s._v(" 分配目录和生成文件。")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" thexp "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Trainer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("Params\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" random\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("myTrainer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Trainer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pass")]),s._v("\n\ntrainer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" myTrainer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Params"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("range")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    trainer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("logger"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("range")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    trainer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("writter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("add_scalar"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("random"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("random"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# trainer.saver")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# trainer.rnd")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("blockquote",[t("p",[s._v("为了减少计算和内存开销，"),t("code",[s._v("Trainer")]),s._v(" 类内部采用懒加载（在真正使用到时才会创建）的方式对之前提到的 "),t("code",[s._v("Saver")]),s._v("/"),t("code",[s._v("RndManager")]),s._v("/"),t("code",[s._v("Logger")]),s._v("/"),t("code",[s._v("Experiment")]),s._v(" 类各自维护了一个实例，同时还维护了一个 "),t("code",[s._v("Tensorboard")]),s._v(" 中的 "),t("code",[s._v("SummaryWritter")]),s._v(" 实例。此外，这些实例均在 "),t("code",[s._v("Experiment")]),s._v(" 按照相应的方法进行了注册，可以直接用于回溯和分析。")])]),s._v(" "),t("h2",{attrs:{id:"使用trainer构建训练流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用trainer构建训练流程"}},[s._v("#")]),s._v(" 使用Trainer构建训练流程")]),s._v(" "),t("p",[s._v("下面展示了一个简单的完整的训练流程")]),s._v(" "),t("p",[s._v("模型部份")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" torch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("nn "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" nn\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyModel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("__init__")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("super")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__init__"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" nn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Linear"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("forward")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("view"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("shape"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" x\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("Trainer部份：定义一个类，并重写 "),t("code",[s._v("callbacks")]),s._v("/"),t("code",[s._v("datasets")]),s._v("/"),t("code",[s._v("models")]),s._v("/"),t("code",[s._v("train_batch")]),s._v(" 方法")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" thexp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("frame "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Meter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Params"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Trainer\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyTrainer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Trainer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("callbacks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" params"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Params"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" thexp "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" callbacks\n        callbacks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("LoggerCallback"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hook"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加日志输出功能")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("datasets")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" params"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Params"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" torchvision "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" transforms\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" torchvision"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("datasets "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" FakeData\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" thexp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("torch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dataloader "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" DataLoader\n\n        dataset "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" FakeData"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("size"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" image_size"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" transform"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("transforms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ToTensor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        train_loader "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" eval_loader "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" test_loader "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DataLoader"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dataset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" shuffle"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" batch_size"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" drop_last"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n        self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("regist_databundler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n            train"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("train_loader"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            test"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test_loader"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("eval")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eval_loader"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("to"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("device"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("models")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" params"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Params"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" torch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("optim "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" SGD\n        self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("model "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" MyModel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("optim "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" SGD"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("model"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("parameters"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" lr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("params"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cross "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" nn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CrossEntropyLoss"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("to"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("device"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("train_batch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" eidx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" idx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" global_step"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" batch_data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" params"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" device"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        optim"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" cross "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("optim"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cross\n        meter "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Meter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        xs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ys "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" batch_data\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 训练逻辑")]),s._v("\n        logits "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("model"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("xs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        meter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loss "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cross"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("logits"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ys"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 反向传播")]),s._v("\n        meter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loss"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("backward"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        optim"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("step"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        optim"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("zero_grad"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" meter\n\n\nparams "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Params"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nparams"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("epoch"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\nparams"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v("\n\ntrainer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" MyTrainer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("params"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ntrainer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("train"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br")])]),t("p",[s._v("运行该文件，如果没有意外，你会看到类似如下的输出：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("add output channel on .../.thexp/experiments\\....1b\\val.myExp\\0002.3d1be080\\l.200811220612.0.log\n20-08-11 22:06:12 | {'train': DataBundler([('unnamed_0', 10)]), 'eval': DataBundler([('unnamed_0', 10)]), 'tests': DataBundler([('unnamed_0', 10)])}\n20-08-11 22:06:12 | Exp BaseDir | e:\\python\\read\\...\\.thexp\\experiments\\....1b\\val.myExp\n20-08-11 22:06:12 | Exp Trainer | MyTrainer\n20-08-11 22:06:12 | Exp Params | Params[('epoch', 20), ('eidx', 1),\n ('idx', 0),\n ('global_step', 0),\n ('device', 'cpu'),\n ('dataset', None),\n ('architecture', None),\n ('optim', None),\n ('lr', 0.01)]\n20-05-15 16:36:17 | <LoggerCallback([priority=0]) at 0x0000018DD2733908> hooked on <__main__.MyTrainer object at 0x0000018DCFB6ECC0>.\n20-05-15 16:36:17 | 1/20\n20-05-15 16:36:17 | 8/10 | loss: 2.3161(2.3121)\n20-05-15 16:36:17 | train: 0s | epoch: 0s | avg: 0s | last: 8s\n20-05-15 16:36:17 | 2/20\n20-05-15 16:36:18 | 8/10 | loss: 2.3442(2.2952)\n20-05-15 16:36:18 | train: 0s | epoch: 0s | avg: 0s | last: 8s\n20-05-15 16:36:18 | 3/20\n20-05-15 16:36:18 | 8/10 | loss: 2.3278(2.2851)\n20-05-15 16:36:18 | train: 1s | epoch: 0s | avg: 0s | last: 7s\n20-05-15 16:36:18 | 4/20\n...\nTest end:\n['0002.3d1be080']\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("h2",{attrs:{id:"auto-device"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#auto-device"}},[s._v("#")]),s._v(" Auto device")]),s._v(" "),t("p",[s._v("在上面的代码示例中，可以看到重写的"),t("code",[s._v("datasets()")]),s._v("和"),t("code",[s._v("models()")]),s._v("方法最后都调用了 "),t("code",[s._v("to(self.device)")]),s._v("，该方法作用和 "),t("code",[s._v("model.to(device)")]),s._v("/"),t("code",[s._v("tensor.to(device)")]),s._v(" 作用类似，且更加的简便，在训练过程中，无需再次声明或者为向量重新指定 device。")]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("Trainer")]),s._v(" 中的 "),t("code",[s._v("device")]),s._v(" 变量（"),t("code",[s._v("torch.device")]),s._v("） 默认生成于 "),t("code",[s._v("Params")]),s._v(" 中的 "),t("code",[s._v("device")]),s._v(" 变量（"),t("code",[s._v("str")]),s._v("）")])]),s._v(" "),t("blockquote",[t("p",[s._v("该方法暂时还没有支持和测试多GPU下的情况")])]),s._v(" "),t("h2",{attrs:{id:"回调函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#回调函数"}},[s._v("#")]),s._v(" 回调函数")]),s._v(" "),t("p",[t("code",[s._v("thexp")]),s._v(" 为 "),t("code",[s._v("Trainer")]),s._v(" 提供了一套回调机制，在之前的示例中，"),t("code",[s._v("MyTrainer")]),s._v("类重写了 "),t("code",[s._v("callbacks()")]),s._v(" 方法，并在其中注册了 "),t("code",[s._v("LoggerCallback")]),s._v("，从而在训练过程中能够自动完成日志输出。如果不注册该回调类，则在大多数过程中程序都会保持静默。")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("在 "),t("code",[s._v("Trainer")]),s._v(" 的一些方法中，也有一些方法会主动的进行日志输出。")])]),s._v(" "),t("p",[s._v("所有回调类的注册方法均通过 "),t("code",[s._v("hook(trainer)")]),s._v(" 来完成，"),t("code",[s._v("thexp")]),s._v("提供了众多的回调类，包括自动保存、日志自动输出等，位于 "),t("a",{attrs:{href:"https://github.com/sailist/thexp/blob/master/thexp/frame/callbacks.py",target:"_blank",rel:"noopener noreferrer"}},[s._v("thexp.frame.callbacks"),t("OutboundLink")],1),s._v("，您可以通过下面的语句直接导入并使用：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" thexp "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" callbacks\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("推荐默认 `callback`")]),s._v(" "),t("p",[s._v("按照 "),t("code",[s._v("约定优于配置")]),s._v(" 的原则，"),t("code",[s._v("callback")]),s._v(" 模块实现了许多和超参数中变量名相关的回调类，您可以根据需求酌情添加（如"),t("code",[s._v("EMAUpdate")]),s._v("或"),t("code",[s._v("LRSchedule")]),s._v("），或编写适合您自身试验的回调类。")]),s._v(" "),t("p",[s._v("但在这些模块中，仍然有几个比较通用的回调类，在默认情况下，添加会节省许多代码，这包括：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("callbacks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("LoggerCallback"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用于对 train/test/eval 过程中的记录值进行日志输出")]),s._v("\ncallbacks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("AutoRecord"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用于自动记录 train/test/eval 流程中返回的Meter中的值到 Tensorboard 中")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("h2",{attrs:{id:"其他细节"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其他细节"}},[s._v("#")]),s._v(" 其他细节")]),s._v(" "),t("h3",{attrs:{id:"多继承-callback"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#多继承-callback"}},[s._v("#")]),s._v(" 多继承 callback")]),s._v(" "),t("p",[s._v("通过多继承，可以让 "),t("code",[s._v("Trainer")]),s._v(" 自身成为一个回调类：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MultiHeadBaseTrainer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("callbacks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TrainCallback"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                           "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                           Trainer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("callbacks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" params"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MultiHeadParams"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("super")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("callbacks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("params"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hook"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("这种多继承的方式对一些仅针对某实验的回调需求比较友好。")]),s._v(" "),t("h3",{attrs:{id:"更改实验名"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更改实验名"}},[s._v("#")]),s._v(" 更改实验名")]),s._v(" "),t("p",[s._v("上面的日志中，可以看到实验级别的目录名为 "),t("code",[s._v("val.myExp")]),s._v(" 。其中，"),t("code",[s._v("val")]),s._v(" 为"),t("code",[s._v("Trainer")]),s._v(" 所在的文件名，"),t("code",[s._v("myExp")]),s._v(" 则为 "),t("code",[s._v("Trainer")]),s._v(" 的类名的前缀部份（去掉 "),t("code",[s._v("Trainer")]),s._v(" 后缀，补上 "),t("code",[s._v("Exp")]),s._v(" 后缀）。如果需要主动命名实验，则需要更改该类的类变量 "),t("code",[s._v("__exp_name__")]),s._v("：，此时实验名构造为 "),t("code",[s._v("{模块文件名}.{__exp_name__}")])]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyTrainer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Trainer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    __exp_name__ "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DemoExp"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("此时构造的实验名就会变成 "),t("code",[s._v("val.DemoExp")])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("添加模块名是为了尽可能的保证实验名唯一。在大多数情况下，这种区分方式已经足以在默认（不改动）情况下区分开不同性质的实验名，但总有例外，请使用者注意区分。")])]),s._v(" "),t("h2",{attrs:{id:"params-支持"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#params-支持"}},[s._v("#")]),s._v(" Params 支持")]),s._v(" "),t("p",[s._v("如之前提到的，为了更方便的使用，"),t("code",[s._v("Trainer")]),s._v(" 对 "),t("code",[s._v("Params")]),s._v(" 额外添加了一些功能支持，具体如下：")]),s._v(" "),t("h3",{attrs:{id:"device"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#device"}},[s._v("#")]),s._v(" device")]),s._v(" "),t("p",[t("code",[s._v("Trainer")]),s._v(" 中的 "),t("code",[s._v("device")]),s._v(" 变量（"),t("code",[s._v("torch.device")]),s._v("） 默认生成于 "),t("code",[s._v("Params")]),s._v(" 中的 "),t("code",[s._v("device")]),s._v(" 变量（"),t("code",[s._v("str")]),s._v("）")]),s._v(" "),t("h3",{attrs:{id:"计数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#计数"}},[s._v("#")]),s._v(" 计数")]),s._v(" "),t("p",[t("code",[s._v("Params")]),s._v(" 中默认在训练过程中更改以下三个 "),t("code",[s._v("Params")]),s._v(" 变量")]),s._v(" "),t("ul",[t("li",[s._v("eidx # 以运行的 epoch 数，从1开始")]),s._v(" "),t("li",[s._v("idx # 当前 epoch 的 迭代次数，即经过了多少个 batch")]),s._v(" "),t("li",[s._v("global_step # 总迭代次数（总共经过了多少个 batch）")])]),s._v(" "),t("h3",{attrs:{id:"initial"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#initial"}},[s._v("#")]),s._v(" initial")]),s._v(" "),t("p",[t("code",[s._v("Trainer")]),s._v(" 初始化的最初会同时调用 "),t("code",[s._v("Params")]),s._v(" 中的 "),t("code",[s._v("initial()")]),s._v(" 方法，因此如果需要一些根据最终输入参数动态生成的参数，可以放在该方法中（如 "),t("code",[s._v("Schedule")]),s._v("）。")]),s._v(" "),t("blockquote",[t("p",[s._v("当然，单独使用并手动调用 "),t("code",[s._v("initial()")]),s._v(" 方法也是可以的。")])])])}),[],!1,null,null,null);a.default=e.exports}}]);